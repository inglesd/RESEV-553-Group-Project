---
title: "In Class Example - Data Cleaning"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```
Open and rename Data
```{r}
library(haven)
prgusap1_puf <- read_sas("prgusap1_puf.sas7bdat", 
    NULL)
View(prgusap1_puf)
df <- prgusap1_puf
```
Cut out Extra variables and rename columns
```{r}
#select(RACETHN_5CAT, REGION_US, EDCAT8, J_Q09USX)
#rename(Race5=RACETHN_5CAT, Region=REGION_US, EDU8=EDCAT8, Income=J_Q09USX)
df_small <- df%>%
  select(RACETHN_5CAT, REGION_US, EDCAT8, J_Q09USX) %>%
  rename(Race=RACETHN_5CAT, Region=REGION_US, EDUC=EDCAT8, Income=J_Q09USX)

```

Change name of Race Variables
```{r}
df_Race <- df_small %>%
  mutate(Race = ifelse(Race==1, "Hispanic",
                       ifelse(Race==2, "White",
                              ifelse(Race==3, "Black",
                                     ifelse(Race==4, "Asian/Pacific Islander",
                                            ifelse(Race==6, "Other", "Not Stated" ))))))
                                                   #ifelse(Race==is.na(NA), "Not Stated", "NA")))))))
```
Change name of Region Variables
```{r}
df_Region_Race <- df_Race %>%
  mutate(Region = ifelse(Region== 1, "Northeast",
                         ifelse(Region== 2, "Midwest",
                                ifelse(Region== 3, "South",
                                       ifelse(Region== 4, "West", "Other Region")))))
```
Change name of Education Variables
```{r}
df_Ed_Reg_Race <- df_Region_Race %>%
  mutate(EDUC = ifelse(EDUC==1 | EDUC==2, "Primary",
                       ifelse(EDUC==3 | EDUC==4, "Secondary",
                              ifelse(EDUC==6, "Bachelors",
                                     ifelse(EDUC==7, "Masters",
                                            ifelse(EDUC==5 | EDUC==8, "Professional", "Other"))))))
                                                   #ifelse(EDUC== NA, "Not Stated")))))))
```
Change name of Income Variable
```{r}
df_ALL <- df_Ed_Reg_Race %>%
  mutate(Income = ifelse(Income== 1 | Income== 2, "1-19,999",
                         ifelse(Income== 3 | Income== 4, "20,000-39,999",
                                ifelse(Income== 5 | Income== 6, "40,000-59,999",
                                       ifelse(Income== 7, "60,000-74,999",
                                              ifelse(Income== 8, "75,000-99,999",
                                                     ifelse(Income== 9, "100,000-149,999",
                                                            ifelse(Income== 10, "150,000 +", "Other" ))))))))
                                                                   #ifelse(Income== 11 | Income== is.na(NA), "Not Stated", "Other Income"))))))))) 
```
Normal Descriptive Stats
```{r}

desc_stat_continuous <- df_ALL %>% group_by(Region,Income,Race,EDUC) %>%
  summarize(N=n(),
             mean=mean(Income),
             SD=sd(Income))

 write.csv(desc_state, "desc_stat_continuous.csv")
```
Descriptive Statistics Counts and Percent All
```{r}
desc_stat_ALL <- df_ALL %>%
  group_by(Region, Income, EDUC, Race)%>%
  summarize(N=n())%>%
  ungroup()%>%
  group_by(Region) %>%
  mutate (perc = N/sum(N))
  
write.csv(desc_stat_ALL, "desc_stat_ALL.csv")
desc_stat_ALL <- as.data.frame(desc_stat_ALL)
```


Descriptive Statistics for plot for Income by Region
```{r}
desc_stat_Income <- df_ALL %>% group_by(Region,Income) %>%
  summarise(N=n()) %>%
  ungroup() %>%
  group_by(Region) %>%
  mutate (perc = N/sum(N))

write.csv(desc_stat_Income, "desc_stat_Income.csv")
desc_stat_Income <- as.data.frame(desc_stat_Income)
```


Plot of Income by region
```{r}
desc_stat_Income$Income <- factor(desc_stat_Income$Income,levels = c( "1-19,999", "20,000-39,999", "40,000-59,999", "60,000-74,999", "75,000-99,999", "100,000-149,999", "150,000 +", "Not Stated"))

ggplot(desc_stat_Income, aes(x = Region, y=perc, fill=Income)) +
  geom_bar(stat="identity", position=position_dodge()) +
  scale_y_continuous(label = scales::: percent_format(accuracy =1))

```
Descriptive Statistics for Plot of Race by Region
```{r}
desc_stat_Race <- df_ALL %>% group_by(Region,Race) %>%
  summarise(N=n()) %>%
  ungroup() %>%
  group_by(Region) %>%
  mutate (perc = N/sum(N))

write.csv(desc_stat_Race, "desc_stat_Race.csv")
desc_stat_Race <- as.data.frame(desc_stat_Race)
```

Plot of Race by Region
```{r}
ggplot(desc_stat_Race, aes(x = Region, y=perc, fill=Race)) +
  geom_bar(stat="identity", position=position_dodge()) +
  scale_y_continuous(label = scales::: percent_format(accuracy =1))
```
Descriptive Statistics of Education by Region
```{r}
desc_stat_EDUC <- df_ALL %>% group_by(EDUC, Region) %>%
  summarise(N=n()) %>%
  ungroup() %>%
  group_by(Region) %>%
  mutate (perc = N/sum(N))

write.csv(desc_stat_EDUC, "desc_stat_EDUC.csv")
desc_stat_EDUC <- as.data.frame(desc_stat_EDUC)
```

Plot of Education by Region
```{r}
desc_stat_EDUC$EDUC <- factor(desc_stat_EDUC$EDUC, levels =c("Primary", "Secondary", "Bachelors", "Masters", "Professional", "Other"))

ggplot(desc_stat_EDUC, aes(x = Region, y=perc, fill=EDUC)) +
  geom_bar(stat="identity", position=position_dodge()) +
  scale_y_continuous(label = scales::: percent_format(accuracy =1))
```

